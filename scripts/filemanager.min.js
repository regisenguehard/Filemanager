/*
    MIT License
 @author        Jason Huck - Core Five Labs
 @author        Simon Georget <simon (at) linea21 (dot) com>
 @copyright Authors
*/
(function(e){function f(e){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t){throw new Error("XMLHttpRequest not supported")}t.open("HEAD",e,false);t.send(null);if(t.status==200){return true}return false}function v(t,n){if(t["File Type"]=="dir"&&n=="download")return false;if(typeof t["Capabilities"]=="undefined")return true;else return e.inArray(n,t["Capabilities"])>-1}function B(t){var n=t.attr("class").replace(/ /g,"_");if(n=="")return"itemOptions";if(!e("#"+n).length){var r=e("#itemOptions").clone().attr("id",n);if(!t.hasClass("cap_select"))e(".select",r).remove();if(!t.hasClass("cap_download"))e(".download",r).remove();if(!t.hasClass("cap_rename"))e(".rename",r).remove();if(!t.hasClass("cap_delete"))e(".delete",r).remove();e("#itemOptions").after(r)}return n}e.urlParam=function(e){var t=(new RegExp("[\\?&]"+e+"=([^&#]*)")).exec(window.location.href);if(t)return t[1];else return 0};var t=function(){var t=null;e.ajax({async:false,url:"./scripts/filemanager.config.js",dataType:"json",cache:false,success:function(e){t=e}});return t}();var n=t.options.fileConnector||"connectors/"+t.options.lang+"/filemanager."+t.options.lang;var r=new Array("select","download","rename","delete");if(e.urlParam("langCode")!=0&&f("scripts/languages/"+e.urlParam("langCode")+".js"))t.options.culture=e.urlParam("langCode");var s=[];e.ajax({url:"scripts/languages/"+t.options.culture+".js",async:false,dataType:"json",success:function(e){s=e}});e.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:false});var o=function(){var n=20;if(t.options.searchBox===true)n+=33;var r=e(window).height()-e("#uploader").height()-n;e("#splitter, #filetree, #fileinfo, .vsplitbar").height(r);var i=e("#splitter").width()-6-e("#filetree").width();e("#fileinfo").width(i)};var u=function(e,n){n=typeof n==="undefined"?true:false;if(t.options.showFullPath==false){if("function"===typeof displayPathDecorator){return displayPathDecorator(e.replace(fileRoot,"/"))}else{e=e.replace(fileRoot,"/");if(e.length>50&&n===true){var r=e.split("/");e="/"+r[1]+"/"+r[2]+"/(...)/"+r[r.length-2]+"/"}return e}}else{return e}};var a=function(t){if(t=="grid"){e("#grid").addClass("ON");e("#list").removeClass("ON")}else{e("#list").addClass("ON");e("#grid").removeClass("ON")}};var l=function(e,t,n){var r=String(n);for(i=0;i<e.length;i++){var s=RegExp(e[i],"g");var o=t[i];r=r.replace(s,o)}return r};var c=function(e){var n="";var r=new Array("Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/");var i=new Array("S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","y","y","b","y","R","r","_","_","");n=l(r,i,e);if(t.options.chars_only_latin){n=n.replace(/[^_a-zA-Z0-9]/g,"")}n=n.replace(/[_]+/g,"_");return n};var h=function(e){filename="";if(e.lastIndexOf(".")!=-1){filename=c(e.substr(0,e.lastIndexOf(".")));filename+="."+e.split(".").pop()}else{filename=c(e)}return filename};var p=function(e){var t=parseFloat(e);var n=parseFloat(1024);var r=0;var i=[s.bytes,s.kb,s.mb,s.gb];while(true){if(t<n){t=Math.round(t*100)/100;return t+i[r]}else{t/=n;r+=1}}};var d=function(t){e("#fileinfo").html("<h1>"+t+"</h1>");e("#newfile").attr("disabled","disabled");e("#upload").attr("disabled","disabled");e("#newfolder").attr("disabled","disabled")};var m=function(n){if(t.security.uploadPolicy=="DISALLOW_ALL"){if(e.inArray(y(n),t.security.uploadRestrictions)!=-1)return true}if(t.security.uploadPolicy=="ALLOW_ALL"){if(e.inArray(y(n),t.security.uploadRestrictions)==-1)return true}return false};var g=function(e,t){var n=e.replace(/^.*[\/\\]/g,"");if(typeof t=="string"&&n.substr(n.length-t.length)==t){n=n.substr(0,n.length-t.length)}return n};var y=function(e){if(e.split(".").length==1){return""}return e.split(".").pop().toLowerCase()};var b=function(e){if(e.lastIndexOf(".")!=-1){return e.substring(0,e.lastIndexOf("."))}else{return e}};var w=function(n){if(e.inArray(y(n),t.videos.videosExt)!=-1){return true}else{return false}};var E=function(n){if(e.inArray(y(n),t.audios.audiosExt)!=-1){return true}else{return false}};var S=function(n){var r="<video width="+t.videos.videosPlayerWidth+" height="+t.videos.videosPlayerHeight+' src="'+n["Path"]+'" controls="controls">';r+='<img src="'+n["Preview"]+'" />';r+="</video>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(r)};var x=function(t){var n='<audio src="'+t["Path"]+'" controls="controls">';n+='<img src="'+t["Preview"]+'" />';n+="</audio>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(n)};var T=function(t){e("#fileinfo").find("td:first-child").each(function(){var n=e(this).attr("title");var r=e("#filetree").find('a[rel="'+n+'"]').parent();if(typeof r.css("background-image")!=="undefined"){e(this).css("background-image",r.css("background-image"));window.clearInterval(t)}})};var N=function(t){e("#currentpath").val(t);e("#uploader h1").text(s.current_folder+u(t)).attr("title",u(t,false));e("#newfolder").unbind().click(function(){var t=s.default_foldername;var r=s.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />';var i=function(r,i){if(r!=1)return false;var o=i.children("#fname").val();if(o!=""){t=c(o);var u=new Date;e.getJSON(n+"?mode=addfolder&path="+e("#currentpath").val()+"&name="+t+"&time="+u.getMilliseconds(),function(t){if(t["Code"]==0){P(t["Parent"],t["Name"]);I(t["Parent"]);e("#filetree").find('a[rel="'+t["Parent"]+'/"]').click().click()}else{e.prompt(t["Error"])}})}else{e.prompt(s.no_foldername)}};var o={};o[s.create_folder]=true;o[s.cancel]=false;e.prompt(r,{callback:i,buttons:o})})};var C=function(t){e("#fileinfo button").each(function(t){if(e(this).find("span").length==0)e(this).wrapInner("<span></span>")});if(!v(t,"select")){e("#fileinfo").find("button#select").hide()}else{e("#fileinfo").find("button#select").click(function(){L(t)}).show();if(window.opener||window.tinyMCEPopup){e("#preview img").attr("title",s.select);e("#preview img").click(function(){L(t)}).css("cursor","pointer")}}if(!v(t,"rename")){e("#fileinfo").find("button#rename").hide()}else{e("#fileinfo").find("button#rename").click(function(){var n=A(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!v(t,"delete")){e("#fileinfo").find("button#delete").hide()}else{e("#fileinfo").find("button#delete").click(function(){if(O(t))e("#fileinfo").html("<h1>"+s.select_from_left+"</h1>")}).show()}if(!v(t,"download")){e("#fileinfo").find("button#download").hide()}else{e("#fileinfo").find("button#download").click(function(){window.location=n+"?mode=download&path="+encodeURIComponent(t["Path"])}).show()}};var k=function(){e("#filetree").fileTree({root:fileRoot,datafunc:q,multiFolder:false,folderCallback:function(e){I(e)},expandedFolder:fullexpandedFolder,after:function(n){e("#filetree").find("li a").each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).attr("rel");j(t,i)})});if(t.options.searchBox==true){e("#q").liveUpdate("#filetree ul").blur();e("#search span.q-inactive").html(s.search);e("#search a.q-reset").attr("title",s.search_reset)}}},function(e){F(e)})};var L=function(n){if(t.options.relPath!=false){var r=relPath+n["Path"]}else{var r=relPath+n["Path"]}r=r.replace("//","/");if(window.opener||window.tinyMCEPopup||e.urlParam("field_name")){if(window.tinyMCEPopup){var i=tinyMCEPopup.getWindowArg("window");i.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=r;if(typeof i.ImageDialog!="undefined"){if(i.ImageDialog.getImageData)i.ImageDialog.getImageData();if(i.ImageDialog.showPreviewImage)i.ImageDialog.showPreviewImage(r)}tinyMCEPopup.close();return}if(e.urlParam("field_name")){parent.document.getElementById(e.urlParam("field_name")).value=r;if(typeof top.tinyMCE!=="undefined"){top.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}else if(e.urlParam("CKEditor")){window.opener.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),r)}else{if(n["Properties"]["Width"]!=""){var o=r;var u=n["Properties"]["Width"];var a=n["Properties"]["Height"];window.opener.SetUrl(o,u,a)}else{window.opener.SetUrl(r)}}window.close()}else{e.prompt(s.fck_select_integration)}};var A=function(r){var i="";var o=s.new_filename+' : <input id="rname" name="rname" type="text" value="'+b(r["Filename"])+'" />';var u=function(o,u){if(o!=1)return false;rname=u.children("#rname").val();if(rname!=""){var a=h(rname);var f=y(r["Filename"]);if(f.length>0){a=a+"."+f}var l=r["Path"];var c=n+"?mode=rename&old="+r["Path"]+"&new="+a;e.ajax({type:"GET",url:c,dataType:"json",async:false,success:function(n){if(n["Code"]==0){var o=n["New Path"];var u=n["New Name"];_(l,o,u);var a=e("#preview h1").attr("title");if(typeof a!="undefined"&&a==l){e("#preview h1").text(u)}if(e("#fileinfo").data("view")=="grid"){e('#fileinfo img[alt="'+l+'"]').parent().next("p").text(u);e('#fileinfo img[alt="'+l+'"]').attr("alt",o)}else{e('#fileinfo td[title="'+l+'"]').text(u);e('#fileinfo td[title="'+l+'"]').attr("title",o)}e("#preview h1").html(u);r["Path"]=o;r["Filename"]=u;e("#fileinfo").find("button#rename, button#delete, button#download").unbind();C(r);if(t.options.showConfirmation)e.prompt(s.successful_rename)}else{e.prompt(n["Error"])}i=n["New Name"]}})}};var a={};a[s.rename]=true;a[s.cancel]=false;e.prompt(o,{callback:u,buttons:a});return i};var O=function(r){var i=false;var o=s.confirmation_delete;var a=function(o,a){if(o!=1)return false;var f=n+"?mode=delete&path="+encodeURIComponent(r["Path"]),l=r["Path"].split("/").reverse().slice(1).reverse().join("/")+"/";e.ajax({type:"GET",url:f,dataType:"json",async:false,success:function(n){if(n["Code"]==0){D(n["Path"]);var r=n["Path"].substring(0,n["Path"].length-1);r=r.substr(0,r.lastIndexOf("/")+1);e("#uploader h1").text(s.current_folder+u(r)).attr("title",u(r,false));i=true;if(t.options.showConfirmation)e.prompt(s.successful_delete);e("#filetree").find('a[rel="'+l+'/"]').click().click()}else{i=false;e.prompt(n["Error"])}}})};var f={};f[s.yes]=true;f[s.no]=false;e.prompt(o,{callback:a,buttons:f});return i};var M=function(n,r){var i=y(r);var o=e("#filetree").find('a[rel="'+n+'"]');var u=o.parent();var a='<li class="file ext_'+i+'"><a rel="'+n+r+'" href="#" class="">'+r+"</a></li>";if(!u.find("ul").size()){u=e("#filetree").find("ul.jqueryFileTree");u.prepend(a);k()}else{u.find("ul").prepend(a);o.click().click()}I(n);if(t.options.showConfirmation)e.prompt(s.successful_added_file)};var _=function(t,n,r){var i=e("#filetree").find('a[rel="'+t+'"]');var s=i.parent().parent().prev("a");i.attr("rel",n).text(r);s.click().click()};var D=function(t){e("#filetree").find('a[rel="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()});if(e("#fileinfo").data("view")=="grid"){e('#contents img[alt="'+t+'"]').parent().parent().fadeOut("slow",function(){e(this).remove()})}else{e("table#contents").find('td[title="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()})}if(e("#preview").length){I(t.substr(0,t.lastIndexOf("/")+1))}};var P=function(n,r){var i='<li class="directory collapsed"><a rel="'+n+r+'/" href="#">'+r+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>';var o=e("#filetree").find('a[rel="'+n+'"]');if(n!=fileRoot){o.next("ul").prepend(i).prev("a").click().click()}else{e("#filetree > ul").prepend(i);e("#filetree").find('li a[rel="'+n+r+'/"]').attr("class","cap_rename cap_delete").click(function(){I(n+r+"/")}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).attr("rel");j(t,i)})})}if(t.options.showConfirmation)e.prompt(s.successful_added_folder)};var H=function(t){if(t.lastIndexOf("/")==t.length-1){I(t);e("#filetree").find('a[rel="'+t+'"]').click()}else{F(t)}};var j=function(t,r){var i=new Date;e.getJSON(n+"?mode=getinfo&path="+r+"&time="+i.getMilliseconds(),function(r){if(e("#fileinfo").data("view")=="grid"){var i=e("#fileinfo").find('img[alt="'+r["Path"]+'"]').parent()}else{var i=e("#fileinfo").find('td[title="'+r["Path"]+'"]').parent()}switch(t){case"select":L(r);break;case"download":window.location=n+"?mode=download&path="+r["Path"];break;case"rename":var s=A(r);break;case"delete":O(r);break}})};var F=function(r){var i=r.substr(0,r.lastIndexOf("/")+1);N(i);var o='<div id="preview"><img /><h1></h1><dl></dl></div>';o+='<form id="toolbar">';if(window.opener||window.tinyMCEPopup||e.urlParam("field_name"))o+='<button id="select" name="select" type="button" value="Select">'+s.select+"</button>";o+='<button id="download" name="download" type="button" value="Download">'+s.download+"</button>";if(t.options.browseOnly!=true)o+='<button id="rename" name="rename" type="button" value="Rename">'+s.rename+"</button>";if(t.options.browseOnly!=true)o+='<button id="delete" name="delete" type="button" value="Delete">'+s.del+"</button>";o+='<button id="parentfolder">'+s.parentfolder+"</button>";o+="</form>";e("#fileinfo").html(o);e("#parentfolder").click(function(){I(i)});var u=new Date;e.getJSON(n+"?mode=getinfo&path="+encodeURIComponent(r)+"&time="+u.getMilliseconds(),function(n){if(n["Code"]==0){e("#fileinfo").find("h1").text(n["Filename"]).attr("title",r);e("#fileinfo").find("img").attr("src",n["Preview"]);if(w(n["Filename"])&&t.videos.showVideoPlayer==true){S(n)}if(E(n["Filename"])&&t.audios.showAudioPlayer==true){x(n)}var i="";if(n["Properties"]["Width"]&&n["Properties"]["Width"]!="")i+="<dt>"+s.dimensions+"</dt><dd>"+n["Properties"]["Width"]+"x"+n["Properties"]["Height"]+"</dd>";if(n["Properties"]["Date Created"]&&n["Properties"]["Date Created"]!="")i+="<dt>"+s.created+"</dt><dd>"+n["Properties"]["Date Created"]+"</dd>";if(n["Properties"]["Date Modified"]&&n["Properties"]["Date Modified"]!="")i+="<dt>"+s.modified+"</dt><dd>"+n["Properties"]["Date Modified"]+"</dd>";if(n["Properties"]["Size"]||parseInt(n["Properties"]["Size"])==0)i+="<dt>"+s.size+"</dt><dd>"+p(n["Properties"]["Size"])+"</dd>";e("#fileinfo").find("dl").html(i);C(n)}else{e.prompt(n["Error"])}})};var I=function(i){N(i);e("#fileinfo").html('<img id="activity" src="images/wait30trans.gif" width="30" height="30" />');var o=new Date;var u=n+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+t.options.showThumbs+"&time="+o.getMilliseconds();if(e.urlParam("type"))u+="&type="+e.urlParam("type");e.getJSON(u,function(t){var n="";if(t.Code=="-1"){d(t.Error);return}if(t){if(e("#fileinfo").data("view")=="grid"){n+='<ul id="contents" class="grid">';for(key in t){var i=t[key]["Properties"];var o="";for(cap in r){if(v(t[key],r[cap])){o+=" cap_"+r[cap]}}var u=64;var a=i["Width"];if(a>1&&a<u)u=a;n+='<li class="'+o+'" title="'+t[key]["Path"]+'"><div class="clip"><img src="'+t[key]["Preview"]+'" width="'+u+'" alt="'+t[key]["Path"]+'" /></div><p>'+t[key]["Filename"]+"</p>";if(i["Width"]&&i["Width"]!="")n+='<span class="meta dimensions">'+i["Width"]+"x"+i["Height"]+"</span>";if(i["Size"]&&i["Size"]!="")n+='<span class="meta size">'+i["Size"]+"</span>";if(i["Date Created"]&&i["Date Created"]!="")n+='<span class="meta created">'+i["Date Created"]+"</span>";if(i["Date Modified"]&&i["Date Modified"]!="")n+='<span class="meta modified">'+i["Date Modified"]+"</span>";n+="</li>"}n+="</ul>"}else{n+='<table id="contents" class="list">';n+='<thead><tr><th class="headerSortDown"><span>'+s.name+"</span></th><th><span>"+s.dimensions+"</span></th><th><span>"+s.size+"</span></th><th><span>"+s.modified+"</span></th></tr></thead>";n+="<tbody>";for(key in t){var f=t[key]["Path"];var i=t[key]["Properties"];var o="";for(cap in r){if(v(t[key],r[cap])){o+=" cap_"+r[cap]}}n+='<tr class="'+o+'">';n+='<td title="'+f+'">'+t[key]["Filename"]+"</td>";if(i["Width"]&&i["Width"]!=""){n+="<td>"+i["Width"]+"x"+i["Height"]+"</td>"}else{n+="<td></td>"}if(i["Size"]&&i["Size"]!=""){n+='<td><abbr title="'+i["Size"]+'">'+p(i["Size"])+"</abbr></td>"}else{n+="<td></td>"}if(i["Date Modified"]&&i["Date Modified"]!=""){n+="<td>"+i["Date Modified"]+"</td>"}else{n+="<td></td>"}n+="</tr>"}n+="</tbody>";n+="</table>"}}else{n+="<h1>"+s.could_not_retrieve_folder+"</h1>"}e("#fileinfo").html(n);if(e("#fileinfo").data("view")=="grid"){e("#fileinfo").find("#contents li").click(function(){var t=e(this).find("img").attr("alt");H(t)}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).find("img").attr("alt");j(t,i)})})}else{e("#fileinfo tbody tr").click(function(){var t=e("td:first-child",this).attr("title");H(t)}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e("td:first-child",n).attr("title");j(t,i)})});e("#fileinfo").find("table").tablesorter({textExtraction:function(t){if(e(t).find("abbr").size()){return e(t).find("abbr").attr("title")}else{return t.innerHTML}}});var l=setInterval(function(){T(l)},300)}})};var q=function(i,o){var u=new Date;var a=n+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+t.options.showThumbs+"&time="+u.getMilliseconds();if(e.urlParam("type"))a+="&type="+e.urlParam("type");e.getJSON(a,function(e){var n="";if(e.Code=="-1"){d(e.Error);return}if(e){n+='<ul class="jqueryFileTree" style="display: none;">';for(key in e){var i="";for(cap in r){if(v(e[key],r[cap])){i+=" cap_"+r[cap]}}if(e[key]["File Type"]=="dir"){n+='<li class="directory collapsed"><a href="#" class="'+i+'" rel="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}else{if(t.options.listFiles){n+='<li class="file ext_'+e[key]["File Type"].toLowerCase()+'"><a href="#" class="'+i+'" rel="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}}}n+="</ul>"}else{n+="<h1>"+s.could_not_retrieve_folder+"</h1>"}o(n)})};e(function(){if(t.extras.extra_js){for(var r=0;r<t.extras.extra_js.length;r++){e.ajax({url:t.extras.extra_js[r],dataType:"script",async:t.extras.extra_js_async})}}if(!t.options.fileRoot){fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/"}else{if(!t.options.serverRoot){fileRoot=t.options.fileRoot}else{fileRoot="/"+t.options.fileRoot}fileRoot=fileRoot.replace(/\/\//g,"/")}if(t.options.relPath===false){relPath=window.location.protocol+"//"+window.location.host}else{relPath=t.options.relPath}if(e.urlParam("expandedFolder")!=0){expandedFolder=e.urlParam("expandedFolder");fullexpandedFolder=fileRoot+expandedFolder}else{expandedFolder="";fullexpandedFolder=null}if(t.options.autoload==true){e("#upload").append(s.upload);e("#newfolder").append(s.new_folder);e("#grid").attr("title",s.grid_view);e("#list").attr("title",s.list_view);e("#fileinfo h1").append(s.select_from_left);e('#itemOptions a[href$="#select"]').append(s.select);e('#itemOptions a[href$="#download"]').append(s.download);e('#itemOptions a[href$="#rename"]').append(s.rename);e('#itemOptions a[href$="#delete"]').append(s.del)}e("#browse").append("+");e("#browse").attr("title",s.browse);e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))});if(t.options.searchBox===true){e.getScript("./scripts/filemanager.liveSearch.min.js")}else{e("#search").remove()}e("button").wrapInner("<span></span>");e("#fileinfo").data("view",t.options.defaultViewMode);a(t.options.defaultViewMode);e("#home").click(function(){var t=e("#fileinfo").data("view");e("#fileinfo").data("view",t);e("#filetree>ul>li.expanded>a").trigger("click");I(fileRoot)});e("#grid").click(function(){a("grid");e("#fileinfo").data("view","grid");I(e("#currentpath").val())});e("#list").click(function(){a("list");e("#fileinfo").data("view","list");I(e("#currentpath").val())});N(fileRoot);e("#uploader").attr("action",n);e("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(n,r,i){if(e("#newfile",r).val()==""){return false}if(!m(e("#newfile",r).val())){var o="<p>"+s.INVALID_FILE_TYPE+"</p>";if(t.security.uploadPolicy=="DISALLOW_ALL"){o+="<p>"+s.ALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".</p>"}if(t.security.uploadPolicy=="ALLOW_ALL"){o+="<p>"+s.DISALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".</p>"}e("#filepath").val("");e.prompt(o);return false}e("#upload").attr("disabled",true);e("#upload span").addClass("loading").text(s.loading_data);if(e.urlParam("type").toString().toLowerCase()=="images"){var u=e("#newfile",r).val().toLowerCase().split(".");for(key in t.images.imagesExt){if(t.images.imagesExt[key]==u[u.length-1]){return true}}e.prompt(s.UPLOAD_IMAGES_ONLY);e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);return false}if(typeof FileReader!=="undefined"&&typeof t.upload.fileSizeLimit!="auto"){var a=e("#newfile",r).get(0).files[0].size;if(a>t.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+s.file_too_big+"</p><p>"+s.file_size_limit+t.upload.fileSizeLimit+" "+s.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);e.prompt("Error uploading file")},success:function(t){var n=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(n["Code"]==0){M(n["Path"],n["Name"]);e("#filepath, #newfile").val("");e("#filetree").find('a[rel="'+n["Path"]+'/"]').click().click()}else{e.prompt(n["Error"])}e("#upload").removeAttr("disabled");e("#upload span").removeClass("loading").text(s.upload);e("#filepath").val("")}});k();if(!(window.opener||window.tinyMCEPopup||e.urlParam("field_name")))e('#itemOptions a[href$="#select"]').remove();if(t.options.browseOnly==true){e("#file-input-container").remove();e("#upload").remove();e("#newfolder").remove();e("#toolbar").remove("#rename");e(".contextMenu .rename").remove();e(".contextMenu .delete").remove()}o();e(window).resize(o);e("#splitter").splitter({sizeLeft:200});H(fileRoot+expandedFolder)});var R=document.documentElement;R.setAttribute("data-useragent",navigator.userAgent)})(jQuery)